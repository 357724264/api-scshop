<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>修改地址</title>
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="stylesheet" href="../css/sm.min.css">
<link rel="stylesheet" href="../css/sm-extend.min.css">
<link rel="stylesheet" href="../css/fonts/iconfont.css">
<link rel="stylesheet" href="../css/myapp.css">

</head>
<body>
	<div class="page" id="div_temp">
		<script type="text/x-dot-template" id="data_temp">
	  	<header class="bar bar-nav" id="second-bar">
		    <a class="button button-link button-nav pull-left" href="#" onclick="openWin('address_list','');" data-transition='slide-out'>
		      	<span class="icon iconfont icon-xiangzuo2"></span>
		    </a>
	    	<h1 class="title">修改地址</h1>
		    <button id="identifying-btn1" class="button button-link button-nav pull-right sc-bj"  data-transition='slide-out'>
		          保存
		    </button>
	  	</header>

	  	<div class="content padd-content">
	  		<table class="tjdzbox">
	  			<tbody>
	  				<tr>
	  				    <input type="hidden" id="id" value="{{=it.id}}" />
	  					<td class="tjdz-label">收货人&nbsp;:&nbsp;</td>
	  					<td><input id="name" type="text" value="{{=it.name}}" /></td>
	  				</tr>
	  				<tr>
	  					<td class="tjdz-label">手机号码&nbsp;:&nbsp;</td>
	  					<td><input id="phone" type="text" value="{{=it.phone}}" /></td>
	  				</tr>
	  				<tr>
	  					<td class="tjdz-label">身份证&nbsp;:&nbsp;</td>
	  					<td><input id="identity" type="text" value="{{=it.identity}}" /></td>
	  				</tr>
	  				<tr>
	  					<td class="tjdz-label">所在地区&nbsp;:&nbsp;</td>
	  					<td><input  type="text" id='city-picker' value="{{=it.province}} {{=it.city}} {{=it.qu}}" /></td>
	  				</tr>
	  				<tr>
	  					<td class="tjdz-label">详细地址&nbsp;:&nbsp;</td>
	  					<td><input id="address_detail" type="text" value="{{=it.address}}" /></td>
	  				</tr>
	  			</tbody>
	  		</table>

	  		<label class="set-default">
	  			<input id="iscommon" type="checkbox" name = "iscommon" /><i class='iconfont icon-duigou'></i>
	  			设置为默认
	  		</label>
	  	</div>	  	
	  	</script>
	</div>
	<script type="text/javascript" src="../script/doT.js" charset="utf-8"></script>
	<script type='text/javascript' src='../script/base.js' charset='utf-8'></script>
	<script type='text/javascript' src='../script/api.js' charset='utf-8'></script>	
	<script type='text/javascript' src='../script/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='../script/sm.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='../script/sm-extend.min.js' charset='utf-8'></script>  
    <!-- 地址选择 -->
    <script type="text/javascript" src="../script/city.js" charset="utf-8"></script>
    <script type="text/javascript">

	 	apiready = function() {		

	 		var aid = api.pageParam.aid;
	 		api.ajax({
	 			url : BASE_JSON_URL + "app/address!edit.action",
    			method: 'post',
	            cache:true,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values:{
	                	aid : aid
	                }
	            }

	 		},function(ret,err){
	 			var template = $api.byId('data_temp').innerHTML;
	 			$api.byId('div_temp').innerHTML = doT.template(template)(ret);

	 			$("#city-picker").cityPicker({
				    toolbarTemplate: '<header class="bar bar-nav">\
				    <button class="button button-link pull-right close-picker">确定</button>\
				    <h1 class="title">选择收货地址</h1>\
				    </header>'
				});

		 		$(document).on('click','#identifying-btn1',function(){
					var id=$("#id").val();
					var name=$("#name").val();
					var phone=$("#phone").val();
					var identity=$("#identity").val();
					var address=$("#city-picker").val();
					var address_detail=$("#address_detail").val();
					var iscommon=$("#iscommon").is(':checked');
					var defaultadd = iscommon?1:0;
					if(name==""){
					    $.alert("收件人不能为空!");
					    return;
					}
					if (!$("#phone").val().match(/^(((13[0-9]{1})|1[0-9][0-9])+\d{8})$/)) 
				    { 
					$.alert("手机号码格式不正确！");
					return;
				    }
				    if(!identity.match(/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/)){
				        $.alert("身份证号码格式不对");
				        return;
				    }
					if (address_detail<10) { 
						$.alert("详细地址不能少于5个！");
						return;
					}	

					api.ajax({
		    			url : BASE_JSON_URL + "json/address!update.action",
		    			method: 'post',
			            cache:true,
			            timeout: 30,
			            dataType: 'string',
			            returnAll:false,
			            data:{
			                values:{
			                	name:name,
			                	iscommon:defaultadd,
						    	phone:phone,
						     	identity:identity,
						     	address:address,
						      	address_detail:address_detail,
						      	id:id
			                }
			            }
	    			},function(html,err){
	    				if(html=="success"){
								$.alert("修改成功！");
								openWin('address_list','');
								//closeWin();
							}else{
								$.alert("未知错误！");
							}

	    			});

				});

	 		});

	

			
	 	}

	
    </script>

</body>
</html>